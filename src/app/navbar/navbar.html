<nav class="navbar" [class.scrolled]="isScrolled">
  <div class="navbar-container">
    <!-- Logo -->
    <div class="navbar-logo">
      <a href="/">
        <img src="/favicon.ico" alt="W9ayt Delivery Logo" class="logo-image">
      </a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="navbar-toggle" [class.active]="isMenuOpen" (click)="toggleMenu()" aria-label="Toggle navigation">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <!-- Navigation Links -->
    <div class="navbar-menu" [class.active]="isMenuOpen">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a href="/home" class="nav-link" routerLink="/home" routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: true}">Home</a>
        </li>
        @if (!isloggedIn()) {
        <li class="nav-item">
          <a (click)="scrollToSection('how-it-works')" class="nav-link">How it Works</a>
        </li>
        }

        @if(isloggedIn() && currentUser?.role !== 'driver'){
        <!-- Delivery Dropdown Menu -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" [class.active]="isDeliveryOpen" (click)="toggleDeliveryMenu()">
            Delivery
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"
              class="dropdown-icon" [class.rotated]="isDeliveryOpen">
              <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>

          @if (isDeliveryOpen) {
          <div class="dropdown-menu">
            <a routerLink="/history" class="dropdown-item" (click)="closeDeliveryMenu()">History</a>
            <a routerLink="/new-delivery" class="dropdown-item" (click)="closeDeliveryMenu()">New Delivery</a>
            <a routerLink="/chat" class="dropdown-item" (click)="closeDeliveryMenu()">Delivery Chat</a>
          </div>
          }
        </li>
        }
        @if(isloggedIn() && currentUser?.role === 'driver'){
        <!-- Driver Menu -->
        <li class="nav-item">
          <a routerLink="/livreur/deliveries" class="nav-link" routerLinkActive="active">Dashboard</a>
        </li>
        <li class="nav-item">
          <a routerLink="/livreur/deliveryall" class="nav-link" routerLinkActive="active">All Deliveries</a>
        </li>
        }
        @if (!isloggedIn()) {
        <li class="nav-item">
          <a href="/become-a-company" class="nav-link" routerLink="/become-a-company" routerLinkActive="active">Become a
            company</a>
        </li>
        }@else {
        <li class="nav-item">
          <a href="/companies" class="nav-link" routerLink="/companies" routerLinkActive="active">Companies</a>
        </li>
        }
        <li class="nav-item">
          <a (click)="scrollToSection('contact')" class="nav-link">Contact</a>
        </li>


      </ul>
    </div>

    <!-- Auth Actions: Profile Dropdown or Get Started -->
    @if (isloggedIn()) {
    <div class="profile-wrapper">
      <button class="profile-button" (click)="toggleProfile()" aria-label="Profile menu">
        <!-- Profile Icon -->
        <div class="profile-initials">
          {{ currentUser?.name?.charAt(0) | uppercase }}
        </div>
      </button>

      <!-- Dropdown Menu -->
      @if (isProfileOpen) {
      <div class="profile-dropdown">
        <div class="profile-header">
          <div class="profile-avatar">
            <div class="profile-initials large">
              {{ currentUser?.name?.charAt(0) | uppercase }}
            </div>
          </div>
          <div class="profile-info">
            <div class="profile-name">{{ currentUser?.name || 'User' }}</div>
            <div class="profile-email">{{ currentUser?.email || '' }}</div>
          </div>
        </div>

        <ul class="profile-menu">
          <li>
            @if (currentUser?.role === 'driver') {
              <a routerLink="/livreur/profilelivreur" (click)="isProfileOpen = false">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2" />
                  <path d="M4 20c0-4 4-6 8-6s8 2 8 6" stroke="currentColor" stroke-width="2" />
                </svg>
                <span>Profile</span>
              </a>
            } @else {
              <a routerLink="/profile" (click)="isProfileOpen = false">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2" />
                  <path d="M4 20c0-4 4-6 8-6s8 2 8 6" stroke="currentColor" stroke-width="2" />
                </svg>
                <span>Profile</span>
              </a>
            }
          </li>
          <li>
            <button (click)="logout()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <span>Log out</span>
            </button>
          </li>
        </ul>
      </div>
      }
    </div>
    }@else{
    <!-- Get Started Button -->
    <div class="navbar-cta" [class.active]="isMenuOpen">
      <button class="btn-get-started" routerLink="/login">Get Started</button>
    </div>
    }
  </div>
</nav>