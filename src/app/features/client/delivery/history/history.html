<app-navbar></app-navbar>
<div class="history-container">
	<div class="header-section">
		<h2>HistoryPage</h2>
		<a routerLink="/chat" class="chat-link">ðŸ’¬ My Conversations</a>
	</div>
	<div class="search-bar">
		<input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Search for Orders" />
		<select [(ngModel)]="selectedStatus">
			<option value="">All statuses</option>
			<option value="pending">Pending</option>
			<option value="assigned">Assigned</option>
			<option value="in_transit">In transit</option>
			<option value="delivered">Delivered</option>
			<option value="cancelled">Cancelled</option>
		</select>
		<button (click)="applyFilters()" [disabled]="isLoading">Filter</button>
		<button (click)="clearFilters()" [disabled]="isLoading">Clear</button>
	</div>

		<div *ngIf="isLoading" class="loading">Loadingâ€¦</div>

		<ng-container *ngIf="!isLoading">
		<div *ngFor="let delivery of filteredDeliveries" class="delivery-card">
		<div class="delivery-info">
			<div>
				<p><b>Company:</b> {{delivery.company_name || 'Non renseignÃ©e'}}</p>
				<p><b>Driver:</b> {{delivery.driver_name || 'Non assignÃ©'}}</p>
				<p><b>Receiver:</b> {{delivery.receiver_name}} <span
						*ngIf="delivery.receiver_phone">({{delivery.receiver_phone}})</span></p>
				<p><b>Pickup:</b> {{delivery.pickup_address}}</p>
				<p><b>Dropoff:</b> {{delivery.dropoff_address}}</p>
				<p><b>Weight:</b> {{delivery.weight}} kg</p>
				<p><b>Size:</b> {{delivery.size}}</p>
				<p><b>Price:</b> {{delivery.price}} {{delivery.currency}}</p>
				<p>
					<b>Status:</b>
					<span class="status-badge" [ngClass]="delivery.status">
						{{ formatStatus(delivery.status) }}
					</span>
				</p>
				<div class="action-buttons">
					<button *ngIf="delivery.status === 'pending'" class="cancel-btn" (click)="cancelOrder(delivery)">Cancel
						order</button>
					<button *ngIf="delivery.driver_name" class="chat-btn" (click)="openChat(delivery)">ðŸ’¬ Chat with Driver</button>
				</div>
			</div>
		</div>
	</div>
	</ng-container>

	<div class="pagination">
		<button (click)="goToPage(currentPage-1)" [disabled]="currentPage === 1">&lt;</button>
		<span *ngFor="let page of [].constructor(totalPages); let i = index">
			<button (click)="goToPage(i+1)" [class.active]="currentPage === i+1">{{i+1}}</button>
		</span>
		<button (click)="goToPage(currentPage+1)" [disabled]="currentPage === totalPages">&gt;</button>
	</div>

	<!-- Pagination supprimÃ©e, tout l'historique est affichÃ© directement -->
</div>
<app-contact-us></app-contact-us>
<app-footer></app-footer>