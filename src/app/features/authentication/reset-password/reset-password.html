<div class="login-page">
  <!-- Home Button -->
  <a routerLink="/" class="home-button">
    <i class="fas fa-home"></i> Home
  </a>

  <!-- Decorative Shapes -->
  <div class="diagonal-shape top-shape"></div>
  <div class="diagonal-shape bottom-shape"></div>

  <!-- Floating Icons -->
  <div class="floating-icons">
    <i class="fas fa-truck floating-icon icon-1"></i>
    <i class="fas fa-box floating-icon icon-2"></i>
    <i class="fas fa-map-marker-alt floating-icon icon-3"></i>
    <i class="fas fa-route floating-icon icon-4"></i>
    <i class="fas fa-shipping-fast floating-icon icon-5"></i>
    <i class="fas fa-map-marked-alt floating-icon icon-6"></i>
    <i class="fas fa-box-open floating-icon icon-7"></i>
    <i class="fas fa-location-arrow floating-icon icon-8"></i>
    <i class="fas fa-dolly floating-icon icon-9"></i>
    <i class="fas fa-road floating-icon icon-10"></i>
  </div>

  <div class="login-container">
    <!-- Left Side - Illustration -->
    <div class="illustration-section">
      <img src="/login_illu.png" alt="Delivery illustration" class="login-illustration" draggable="false">
    </div>

    <!-- Right Side - Forms -->
    <div class="form-section">
      <div class="login-form-wrapper">
        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="step" [class.active]="currentStep() === 'email'" [class.completed]="currentStep() === 'code' || currentStep() === 'password'">
            <div class="step-number">1</div>
            <div class="step-label">Email</div>
          </div>
          <div class="step-line" [class.completed]="currentStep() === 'code' || currentStep() === 'password'"></div>
          <div class="step" [class.active]="currentStep() === 'code'" [class.completed]="currentStep() === 'password'">
            <div class="step-number">2</div>
            <div class="step-label">Verify Code</div>
          </div>
          <div class="step-line" [class.completed]="currentStep() === 'password'"></div>
          <div class="step" [class.active]="currentStep() === 'password'">
            <div class="step-number">3</div>
            <div class="step-label">New Password</div>
          </div>
        </div>

        <h2 class="form-title">
          @if (currentStep() === 'email') {
            Reset Password
          } @else if (currentStep() === 'code') {
            Verify Code
          } @else {
            New Password
          }
        </h2>
        <div class="title-underline"></div>

        <!-- Success Message Alert -->
        @if (successMessage()) {
          <div class="alert alert-success">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{{ successMessage() }}</span>
          </div>
        }

        <!-- Error Message Alert -->
        @if (errorMessage()) {
          <div class="alert alert-error">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>{{ errorMessage() }}</span>
          </div>
        }

        <!-- Step 1: Email Form -->
        @if (currentStep() === 'email') {
          <form [formGroup]="emailForm" (ngSubmit)="onSubmitEmail()" class="login-form">
            <p class="form-description">Enter your email address to receive a reset code</p>
            
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" class="form-control" formControlName="email"
                placeholder="youremail@domain.com" />
              @if (submitted() && emailFormControls.email.errors?.['required']) {
                <small class="error-text">Email is required</small>
              }
              @if (submitted() && emailFormControls.email.errors?.['email']) {
                <small class="error-text">Enter a valid email</small>
              }
            </div>

            <button type="submit" class="login-btn" [disabled]="isLoading()">
              @if (isLoading()) {
                <span class="spinner"></span>
                Sending...
              } @else {
                Send Reset Code
              }
            </button>

            <div class="back-to-login">
              <a routerLink="/login">Back to Login</a>
            </div>
          </form>
        }

        <!-- Step 2: Verify Code Form -->
        @if (currentStep() === 'code') {
          <form [formGroup]="codeForm" (ngSubmit)="onSubmitCode()" class="login-form">
            <p class="form-description">Enter the 6-digit code sent to <strong>{{ email() }}</strong></p>
            
            <div class="form-group">
              <label for="code">Verification Code</label>
              <input type="text" id="code" class="form-control" formControlName="code"
                placeholder="123456" maxlength="6" />
              @if (submitted() && codeFormControls.code.errors?.['required']) {
                <small class="error-text">Code is required</small>
              }
              @if (submitted() && (codeFormControls.code.errors?.['minlength'] || codeFormControls.code.errors?.['maxlength'])) {
                <small class="error-text">Code must be 6 digits</small>
              }
            </div>

            <button type="submit" class="login-btn" [disabled]="isLoading()">
              @if (isLoading()) {
                <span class="spinner"></span>
                Verifying...
              } @else {
                Verify Code
              }
            </button>

            <div class="back-to-login">
              <a (click)="goToPreviousStep()" style="cursor: pointer;">Change Email</a>
            </div>
          </form>
        }

        <!-- Step 3: New Password Form -->
        @if (currentStep() === 'password') {
          <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()" class="login-form">
            <p class="form-description">Create a new password for your account</p>
            
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" id="newPassword" class="form-control" formControlName="newPassword"
                placeholder="Enter new password" />
              @if (submitted() && passwordFormControls.newPassword.errors?.['required']) {
                <small class="error-text">Password is required</small>
              }
              @if (submitted() && passwordFormControls.newPassword.errors?.['minlength']) {
                <small class="error-text">Password must be at least 6 characters</small>
              }
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input type="password" id="confirmPassword" class="form-control" formControlName="confirmPassword"
                placeholder="Confirm new password" />
              @if (submitted() && passwordFormControls.confirmPassword.errors?.['required']) {
                <small class="error-text">Please confirm your password</small>
              }
            </div>

            <button type="submit" class="login-btn" [disabled]="isLoading()">
              @if (isLoading()) {
                <span class="spinner"></span>
                Resetting...
              } @else {
                Reset Password
              }
            </button>

            <div class="back-to-login">
              <a (click)="goToPreviousStep()" style="cursor: pointer;">Back</a>
            </div>
          </form>
        }
      </div>
    </div>
  </div>
</div>
